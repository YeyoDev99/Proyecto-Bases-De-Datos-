{% extends "main.html" %}

{% block content %}
<section class='section-main d-flex flex-column justify-content-start align-items-center container-fluid p-4'>

    <!-- TÍTULO PRINCIPAL -->
    <h1 class="log-in h1">Informe de Auditoría</h1>
    <h3 class="log-in h3 mb-5">Últimos accesos y acciones en Historias Clínicas</h3>

    <!-- CONTENEDOR DE LA TABLA -->
    <div class="identification w-100 p-4 mb-5 bg-white shadow-lg rounded-3">
        <h4 class="log_title mb-4 border-bottom pb-2 text-danger"><i class="bi bi-shield-lock-fill me-2"></i> Logs de Seguridad</h4>
        <p class="text-muted small">Trazabilidad de los 10 accesos más recientes a la tabla `Historias_Clinicas`.</p>

        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-danger table-opacity-75">
                    <tr>
                        <th scope="col">ID Evento</th>
                        <th scope="col">Fecha y Hora</th>
                        <th scope="col">Empleado (ID)</th>
                        <th scope="col">Acción Realizada</th>
                        <th scope="col">IP de Origen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs_historias %}
                    <tr>
                        <th scope="row">{{ log.pk }}</th>
                        <td>{{ log.fecha_evento|date:"d M Y H:i:s" }}</td>
                        <td>
                            <span class="fw-bold">{{ log.id_emp.persona.first_name }} {{ log.id_emp.persona.last_name }}</span> 
                            <span class="text-muted small">({{ log.id_emp.pk }})</span>
                        </td>
                        <td><span class="badge bg-secondary">{{ log.accion }}</span></td>
                        <td>{{ log.ip_origen }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-4">No se encontraron registros recientes de auditoría para Historias Clínicas.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="text-secondary small mt-2 text-end">
            <i class="bi bi-info-circle"></i> Consulta 4 del Requerimiento
        </div>
    </div>

</section>
{% endblock content %}